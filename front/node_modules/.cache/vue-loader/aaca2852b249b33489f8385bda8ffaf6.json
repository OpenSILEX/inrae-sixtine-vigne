{"remainingRequest":"/home/charlero/GIT/GITLAB/opensilex-dev/inrae-sixtine/front/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/charlero/GIT/GITLAB/opensilex-dev/inrae-sixtine/front/src/components/layout/SixtineLoginComponent.vue?vue&type=script&lang=ts&","dependencies":[{"path":"/home/charlero/GIT/GITLAB/opensilex-dev/inrae-sixtine/front/src/components/layout/SixtineLoginComponent.vue","mtime":1636714207126},{"path":"/home/charlero/GIT/GITLAB/opensilex-dev/inrae-sixtine/front/node_modules/cache-loader/dist/cjs.js","mtime":1635245896600},{"path":"/home/charlero/GIT/GITLAB/opensilex-dev/inrae-sixtine/front/node_modules/thread-loader/dist/cjs.js","mtime":1635245896598},{"path":"/home/charlero/GIT/GITLAB/opensilex-dev/inrae-sixtine/front/node_modules/babel-loader/lib/index.js","mtime":1635246894104},{"path":"/home/charlero/GIT/GITLAB/opensilex-dev/inrae-sixtine/front/node_modules/ts-loader/index.js","mtime":1635245901572},{"path":"/home/charlero/GIT/GITLAB/opensilex-dev/inrae-sixtine/front/node_modules/cache-loader/dist/cjs.js","mtime":1635245896600},{"path":"/home/charlero/GIT/GITLAB/opensilex-dev/inrae-sixtine/front/node_modules/vue-loader/lib/index.js","mtime":1635246896232}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCmltcG9ydCB7IENvbXBvbmVudCwgUmVmIH0gZnJvbSAidnVlLXByb3BlcnR5LWRlY29yYXRvciI7CmltcG9ydCBWdWUgZnJvbSAidnVlIjsKaW1wb3J0IE9wZW5TaWxleFZ1ZVBsdWdpbiBmcm9tICIuLi8uLi8uLi8uLi8uLi9vcGVuc2lsZXgtZnJvbnQvZnJvbnQvc3JjL21vZGVscy9PcGVuU2lsZXhWdWVQbHVnaW4iOwppbXBvcnQgeyBVc2VyIH0gZnJvbSAiLi4vLi4vLi4vLi4vLi4vb3BlbnNpbGV4LWZyb250L2Zyb250L3NyYy9tb2RlbHMvVXNlciI7Ci8vIEB0cy1pZ25vcmUKaW1wb3J0IHsgVG9rZW5HZXREVE8sIEF1dGhlbnRpY2F0aW9uU2VydmljZSB9IGZyb20gIm9wZW5zaWxleC1zZWN1cml0eS9pbmRleCI7Ci8vIEB0cy1pZ25vcmUKaW1wb3J0IEh0dHBSZXNwb25zZSwgeyBPcGVuU2lsZXhSZXNwb25zZSB9IGZyb20gIm9wZW5zaWxleC1zZWN1cml0eS9IdHRwUmVzcG9uc2UiOwppbXBvcnQgeyBGcm9udENvbmZpZ0RUTyB9IGZyb20gIi4uLy4uLy4uLy4uLy4uL29wZW5zaWxleC1mcm9udC9mcm9udC9zcmMvbGliIjsKLy8gQHRzLWlnbm9yZQppbXBvcnQgeyBTeXN0ZW1TZXJ2aWNlLCB2ZXJzaW9uSW5mb0RUTyB9IGZyb20gIm9wZW5zaWxleC1jb3JlL2luZGV4IjsKCkBDb21wb25lbnQKZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2l4dGluZUxvZ2luQ29tcG9uZW50IGV4dGVuZHMgVnVlIHsgCiAgc2VydmljZTogU3lzdGVtU2VydmljZTsKICB2ZXJzaW9uSW5mbzogdmVyc2lvbkluZm9EVE8gPSB7fTsKICAkc3RvcmU6IGFueTsKICAkcm91dGVyOiBhbnk7CiAgJHQ6IGFueTsKCiAgZ2V0IGZvcm0oKSB7CiAgICByZXR1cm4gewogICAgICBlbWFpbDogIiIsCiAgICAgIHBhc3N3b3JkOiAiIgogICAgfTsKICB9CgoKICBnZXQgdXNlcigpIHsKICAgIHJldHVybiB0aGlzLiRzdG9yZS5zdGF0ZS51c2VyOwogIH0KCiAgZ2V0UEhJU01vZHVsZVZlcnNpb24oKXsKICAgIGZvcihsZXQgbW9kdWxlX3ZlcnNpb25faW5kZXggaW4gdGhpcy52ZXJzaW9uSW5mby5tb2R1bGVzX3ZlcnNpb24pewogICAgICBsZXQgbW9kdWxlID0gdGhpcy52ZXJzaW9uSW5mby5tb2R1bGVzX3ZlcnNpb25bbW9kdWxlX3ZlcnNpb25faW5kZXhdCgogICAgICBjb25zb2xlLmxvZyhtb2R1bGUpCiAgICAgIGlmKG1vZHVsZS5uYW1lLmluY2x1ZGVzKCJQaGlzV3NNb2R1bGUiKSl7CiAgICAgICAgcmV0dXJuIG1vZHVsZS52ZXJzaW9uOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gJ1ZlcnNpb24gdW5kZWZpbmVkJwogIH0KCiAgbG9naW5NZXRob2QgPSAicGFzc3dvcmQiOwoKICBnZXQgY29ubmVjdGlvbk9wdGlvbnMoKSB7CiAgICBsZXQgb3B0aW9ucyA9IFsKICAgICAgewogICAgICAgIGlkOiAicGFzc3dvcmQiLAogICAgICAgIGxhYmVsOiB0aGlzLiR0KCJMb2dpbkNvbXBvbmVudC5wYXNzd29yZENvbm5lY3Rpb25UaXRsZSIpCiAgICAgIH0KICAgIF07CgogICAgbGV0IG9wZW5zaWxleENvbmZpZzogRnJvbnRDb25maWdEVE8gPSB0aGlzLiRvcGVuc2lsZXguZ2V0Q29uZmlnKCk7CgogICAgaWYgKG9wZW5zaWxleENvbmZpZy5vcGVuSURBdXRoZW50aWNhdGlvblVSSSkgewogICAgICBvcHRpb25zLnB1c2goewogICAgICAgIGlkOiAib3BlbmlkIiwKICAgICAgICBsYWJlbDogb3BlbnNpbGV4Q29uZmlnLm9wZW5JRENvbm5lY3Rpb25UaXRsZQogICAgICB9KTsKICAgIH0KCiAgICByZXR1cm4gb3B0aW9uczsKICB9CgogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLnZlcnNpb25JbmZvID0gdGhpcy4kb3BlbnNpbGV4LnZlcnNpb25JbmZvOwogIH0KCiAgbG9naW5NZXRob2RDaGFuZ2UobG9naW5NZXRob2QpIHsKICAgIGNvbnNvbGUuZXJyb3IobG9naW5NZXRob2QpOwogICAgaWYgKGxvZ2luTWV0aG9kLmlkID09ICJvcGVuaWQiKSB7CiAgICAgIGxldCBvcGVuc2lsZXhDb25maWc6IEZyb250Q29uZmlnRFRPID0gdGhpcy4kb3BlbnNpbGV4LmdldENvbmZpZygpOwogICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IG9wZW5zaWxleENvbmZpZy5vcGVuSURBdXRoZW50aWNhdGlvblVSSTsKICAgIH0gZWxzZSBpZiAobG9naW5NZXRob2QuaWQgPT0gInBhc3N3b3JkIikgewogICAgICB0aGlzLnZhbGlkYXRvclJlZi5yZXNldCgpOwogICAgfQogIH0KCiAgaXNSZXNldFBhc3N3b3JkKCl7CiAgICBsZXQgb3BlbnNpbGV4Q29uZmlnOiBGcm9udENvbmZpZ0RUTyA9IHRoaXMuJG9wZW5zaWxleC5nZXRDb25maWcoKTsKICAgIHJldHVybiBvcGVuc2lsZXhDb25maWcuYWN0aXZhdGVSZXNldFBhc3N3b3JkOwogIH0KCiAgJG9wZW5zaWxleDogT3BlblNpbGV4VnVlUGx1Z2luOwoKICBzdGF0aWMgYXN5bmMgYXN5bmNJbml0KCRvcGVuc2lsZXg6IE9wZW5TaWxleFZ1ZVBsdWdpbikgewogICAgYXdhaXQgJG9wZW5zaWxleC5sb2FkU2VydmljZSgib3BlbnNpbGV4LXNlY3VyaXR5LkF1dGhlbnRpY2F0aW9uU2VydmljZSIpOwogIH0KCiAgbG9nb3V0KCkgewogICAgdGhpcy4kc3RvcmUuY29tbWl0KCJsb2dvdXQiKTsKICAgIHRoaXMuJHJvdXRlci5wdXNoKCIvIik7CiAgfQoKICBAUmVmKCJ2YWxpZGF0b3JSZWYiKSByZWFkb25seSB2YWxpZGF0b3JSZWYhOiBhbnk7CgogIGZvcmNlUmVmcmVzaCA9IGZhbHNlOwogIG9uTG9naW4oKSB7CiAgICBsZXQgdmFsaWRhdG9yUmVmOiBhbnkgPSB0aGlzLnZhbGlkYXRvclJlZjsKICAgIHZhbGlkYXRvclJlZi52YWxpZGF0ZSgpLnRoZW4oaXNWYWxpZCA9PiB7CiAgICAgIGlmIChpc1ZhbGlkKSB7CiAgICAgICAgdGhpcy4kb3BlbnNpbGV4LnNob3dMb2FkZXIoKTsKICAgICAgICB0aGlzLiRvcGVuc2lsZXgKICAgICAgICAgIC5nZXRTZXJ2aWNlPEF1dGhlbnRpY2F0aW9uU2VydmljZT4oCiAgICAgICAgICAgICJvcGVuc2lsZXgtc2VjdXJpdHkuQXV0aGVudGljYXRpb25TZXJ2aWNlIgogICAgICAgICAgKQogICAgICAgICAgLmF1dGhlbnRpY2F0ZSh7CiAgICAgICAgICAgIGlkZW50aWZpZXI6IHRoaXMuZm9ybS5lbWFpbCwKICAgICAgICAgICAgcGFzc3dvcmQ6IHRoaXMuZm9ybS5wYXNzd29yZAogICAgICAgICAgfSkKICAgICAgICAgIC50aGVuKChodHRwOiBIdHRwUmVzcG9uc2U8T3BlblNpbGV4UmVzcG9uc2U8VG9rZW5HZXREVE8+PikgPT4gewogICAgICAgICAgICBsZXQgdXNlciA9IFVzZXIuZnJvbVRva2VuKGh0dHAucmVzcG9uc2UucmVzdWx0LnRva2VuKTsKICAgICAgICAgICAgdGhpcy4kb3BlbnNpbGV4LnNldENvb2tpZVZhbHVlKHVzZXIpOwogICAgICAgICAgICB0aGlzLmZvcmNlUmVmcmVzaCA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgibG9naW4iLCB1c2VyKTsKICAgICAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCJyZWZyZXNoIik7CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsKICAgICAgICAgICAgaWYgKGVycm9yLnN0YXR1cyA9PSA0MDMpIHsKICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJJbnZhbGlkIGNyZWRlbnRpYWxzIiwgZXJyb3IpOwogICAgICAgICAgICAgIHRoaXMuJG9wZW5zaWxleC5lcnJvckhhbmRsZXIoCiAgICAgICAgICAgICAgICBlcnJvciwKICAgICAgICAgICAgICAgIHRoaXMuJHQoImNvbXBvbmVudC5sb2dpbi5lcnJvcnMuaW52YWxpZC1jcmVkZW50aWFscyIpCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLiRvcGVuc2lsZXguZXJyb3JIYW5kbGVyKGVycm9yKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLiRvcGVuc2lsZXguaGlkZUxvYWRlcigpOwogICAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwogIH0KfQo="},{"version":3,"sources":["SixtineLoginComponent.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"SixtineLoginComponent.vue","sourceRoot":"src/components/layout","sourcesContent":["<template>\n  <div class=\"fullmodal auth-wrapper\" v-if=\"!user.isLoggedIn() || forceRefresh\">\n    <div class=\"container-fluid h-100\">\n      <div class=\"row flex-row h-100 bg-white\">\n        <div class=\"col-xl-8 col-lg-6 col-md-5 p-0 d-md-block d-lg-block d-sm-none d-none\">\n          <div class=\"lavalite-bg\"\n            v-bind:style=\"{'background-image': 'url(' + $opensilex.getResourceURI('images/opensilex-login-bg.jpg') + ')'}\">\n            <div class=\"lavalite-overlay\"></div>\n          </div>\n        </div>\n        <div class=\"col-xl-4 col-lg-6 col-md-7 my-auto p-0\">\n          <div class=\"authentication-form mx-auto\">\n            <div class=\"logo-centered\">\n              <img v-bind:src=\"$opensilex.getResourceURI('images/sixtine-logo.png')\"/>\n            </div>\n            <opensilex-SelectForm\n              v-if=\"connectionOptions.length > 1\"\n              :label=\"$t('LoginComponent.selectLoginMethod')\"\n              :options=\"connectionOptions\"\n              :selected.sync=\"loginMethod\"\n              @select=\"loginMethodChange\"\n            ></opensilex-SelectForm>\n            <p>{{ $t(\"sixtine.login.info\") }}:</p>\n            <ValidationObserver v-if=\"loginMethod == 'password'\" ref=\"validatorRef\">\n              <b-form @submit.prevent=\"onLogin\" class=\"fullmodal-form\">\n                <b-form-group id=\"login-group\" required>\n                  <ValidationProvider :name=\"$t('component.login.validation.email')\" rules=\"required|emailOrUrl\" v-slot=\"{ errors }\" >\n                    <b-form-input id=\"email\" v-model=\"form.email\" required\n                      :placeholder=\"$t('component.login.input.email')\"\n                    ></b-form-input>\n                    <i class=\"ik ik-user\"></i>\n                    <div v-if=\"errors.length > 0\" class=\"error-message alert alert-danger\">{{ errors[0] }}</div>\n                  </ValidationProvider>\n                </b-form-group>\n\n                <b-form-group id=\"password-group\" required>\n                  <ValidationProvider :name=\"$t('component.login.validation.password')\" rules=\"required\" v-slot=\"{ errors }\">\n                    <b-form-input id=\"password\" type=\"password\" v-model=\"form.password\" required\n                      :placeholder=\"$t('component.login.input.password')\"\n                    ></b-form-input>\n                    <i class=\"ik ik-lock\"></i>\n                    <div v-if=\"errors.length > 0\" class=\"error-message alert alert-danger\">{{ errors[0] }}</div>\n                  </ValidationProvider>\n                </b-form-group> \n                <a href=\"forgot-password\" v-if=\"!isResetPassword()\"><span>{{$t('LoginComponent.forgotPassword')}}</span></a>\n                <div class=\"sign-btn text-center\">\n                  <b-button type=\"submit\" variant=\"primary\" v-text=\"$t('component.login.button.login')\"></b-button>\n                </div>\n              </b-form>\n            </ValidationObserver>\n            <div class=\"logo-inrae text-center\">\n              <img v-bind:src=\"$opensilex.getResourceURI('images/logo-marque-inrae.png')\" alt=\"inrae-logo\"/>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { Component, Ref } from \"vue-property-decorator\";\nimport Vue from \"vue\";\nimport OpenSilexVuePlugin from \"../../../../../opensilex-front/front/src/models/OpenSilexVuePlugin\";\nimport { User } from \"../../../../../opensilex-front/front/src/models/User\";\n// @ts-ignore\nimport { TokenGetDTO, AuthenticationService } from \"opensilex-security/index\";\n// @ts-ignore\nimport HttpResponse, { OpenSilexResponse } from \"opensilex-security/HttpResponse\";\nimport { FrontConfigDTO } from \"../../../../../opensilex-front/front/src/lib\";\n// @ts-ignore\nimport { SystemService, versionInfoDTO } from \"opensilex-core/index\";\n\n@Component\nexport default class SixtineLoginComponent extends Vue { \n  service: SystemService;\n  versionInfo: versionInfoDTO = {};\n  $store: any;\n  $router: any;\n  $t: any;\n\n  get form() {\n    return {\n      email: \"\",\n      password: \"\"\n    };\n  }\n\n\n  get user() {\n    return this.$store.state.user;\n  }\n\n  getPHISModuleVersion(){\n    for(let module_version_index in this.versionInfo.modules_version){\n      let module = this.versionInfo.modules_version[module_version_index]\n\n      console.log(module)\n      if(module.name.includes(\"PhisWsModule\")){\n        return module.version;\n      }\n    }\n    return 'Version undefined'\n  }\n\n  loginMethod = \"password\";\n\n  get connectionOptions() {\n    let options = [\n      {\n        id: \"password\",\n        label: this.$t(\"LoginComponent.passwordConnectionTitle\")\n      }\n    ];\n\n    let opensilexConfig: FrontConfigDTO = this.$opensilex.getConfig();\n\n    if (opensilexConfig.openIDAuthenticationURI) {\n      options.push({\n        id: \"openid\",\n        label: opensilexConfig.openIDConnectionTitle\n      });\n    }\n\n    return options;\n  }\n\n  created() {\n    this.versionInfo = this.$opensilex.versionInfo;\n  }\n\n  loginMethodChange(loginMethod) {\n    console.error(loginMethod);\n    if (loginMethod.id == \"openid\") {\n      let opensilexConfig: FrontConfigDTO = this.$opensilex.getConfig();\n      window.location.href = opensilexConfig.openIDAuthenticationURI;\n    } else if (loginMethod.id == \"password\") {\n      this.validatorRef.reset();\n    }\n  }\n\n  isResetPassword(){\n    let opensilexConfig: FrontConfigDTO = this.$opensilex.getConfig();\n    return opensilexConfig.activateResetPassword;\n  }\n\n  $opensilex: OpenSilexVuePlugin;\n\n  static async asyncInit($opensilex: OpenSilexVuePlugin) {\n    await $opensilex.loadService(\"opensilex-security.AuthenticationService\");\n  }\n\n  logout() {\n    this.$store.commit(\"logout\");\n    this.$router.push(\"/\");\n  }\n\n  @Ref(\"validatorRef\") readonly validatorRef!: any;\n\n  forceRefresh = false;\n  onLogin() {\n    let validatorRef: any = this.validatorRef;\n    validatorRef.validate().then(isValid => {\n      if (isValid) {\n        this.$opensilex.showLoader();\n        this.$opensilex\n          .getService<AuthenticationService>(\n            \"opensilex-security.AuthenticationService\"\n          )\n          .authenticate({\n            identifier: this.form.email,\n            password: this.form.password\n          })\n          .then((http: HttpResponse<OpenSilexResponse<TokenGetDTO>>) => {\n            let user = User.fromToken(http.response.result.token);\n            this.$opensilex.setCookieValue(user);\n            this.forceRefresh = true;\n            this.$store.commit(\"login\", user);\n            this.$store.commit(\"refresh\");\n          })\n          .catch(error => {\n            if (error.status == 403) {\n              console.error(\"Invalid credentials\", error);\n              this.$opensilex.errorHandler(\n                error,\n                this.$t(\"component.login.errors.invalid-credentials\")\n              );\n            } else {\n              this.$opensilex.errorHandler(error);\n            }\n            this.$opensilex.hideLoader();\n          });\n      }\n    });\n  }\n}\n</script>\n\n<style scoped lang=\"scss\">\n.fullmodal {\n  display: block;\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  height: 100%;\n  width: 100%;\n  z-index: 9999;\n}\n\n.logo-centered > img {\n  display: inline-block;\n  width: 350px;\n  height: 150px;  \n}\n\n.logo-bg > img{\n  max-width: 100%;\n  max-height: 100%;  \n}\n\n.authentication-form .error-message {\n  top: 37px;\n}\n\n.authentication-form fieldset {\n  margin-bottom: 25px;\n}\n\n.logo-inrae {\n  margin-top: 25px;\n}\n\n</style>\n\n<i18n>\nen:\n  LoginComponent:\n    selectLoginMethod: Select login method\n    passwordConnectionTitle: Connect with password\n    forgotPassword: Forgot password ?\nfr:\n  LoginComponent:\n    selectLoginMethod: Choisir la méthode de connexion\n    passwordConnectionTitle: Connexion par mot de passe\n    forgotPassword: Mot de passe oublié ?\n</i18n>\n"]}]}